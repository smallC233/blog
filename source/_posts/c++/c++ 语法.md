---
title: c++ è¯­æ³•
categories:
  - ç¼–ç¨‹è¯­è¨€
  - c++
---
# c++ è¯­æ³•

## using

C++ ä¸­çš„ `using` å…³é”®å­—æœ‰å¤šç§ç”¨é€”ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å®ƒåœ¨ä¸åŒåœºæ™¯ä¸‹çš„ç”¨æ³•ï¼š

------

### 1. **å¼•å…¥å‘½åç©ºé—´ä¸­çš„åç§°**

æœ€å¸¸è§çš„ç”¨æ³•æ˜¯ç®€åŒ–å‘½åç©ºé—´ä¸­çš„åç§°è®¿é—®ï¼š

```cpp
#include <iostream>
using namespace std;  // å¼•å…¥ std å‘½åç©ºé—´

int main() {
    cout << "Hello, world!" << endl;
    return 0;
}
```

ä¹Ÿå¯ä»¥åªå¼•å…¥æŸä¸ªç‰¹å®šçš„åç§°ï¼Œé¿å…å¼•å…¥æ•´ä¸ªå‘½åç©ºé—´ï¼š

```cpp
using std::cout;
using std::endl;
```

------

### 2. **ç±»å‹åˆ«å**

C++11 èµ·ã€‚

`using` å¯ä»¥ç”¨æ¥å®šä¹‰ç±»å‹åˆ«åï¼Œæ˜¯ `typedef` çš„ç°ä»£æ›¿ä»£è¯­æ³•ï¼š

```cpp
using uint = unsigned int;

// æ›´å¤æ‚çš„æƒ…å†µï¼Œæ¯”å¦‚å‡½æ•°æŒ‡é’ˆï¼š
using Func = void(*)(int);
```

ç”¨ `typedef` å£°æ˜å‡½æ•°æŒ‡é’ˆã€æ¨¡æ¿ç±»å‹æ—¶è¯­æ³•å¾ˆç»•ï¼Œ`using` åˆ™æ›´åƒæ˜¯å˜é‡çš„èµ‹å€¼ï¼Œ**å¯è¯»æ€§æ›´é«˜**ã€‚

```cpp
// typedef æ–¹å¼ï¼š
typedef void (*FuncPtr)(int, double);

// using æ–¹å¼ï¼š
using FuncPtr = void(*)(int, double);
```

------

### 3. **æ¨¡æ¿åˆ«å**

C++11 èµ·ã€‚

é…åˆæ¨¡æ¿ä½¿ç”¨ï¼š

```cpp
template<typename T>
using Vec = std::vector<T>;

Vec<int> v;  // ç›¸å½“äº std::vector<int> v;
```

------

### 4. **åœ¨æ´¾ç”Ÿç±»ä¸­å¼•å…¥åŸºç±»æˆå‘˜**

å½“æ´¾ç”Ÿç±»éšè—äº†åŸºç±»çš„é‡è½½æˆå‘˜å‡½æ•°ï¼ˆçˆ¶ç±»çš„æ„é€ /ææ„å‡½æ•°ä¹Ÿä¼šè¢«éšè—ï¼‰æ—¶ï¼Œå¯ä»¥ç”¨ `using` æ˜¾å¼å¼•å…¥ï¼š

```cpp
struct Base {
    void func(int) {}
    void func(double) {}
};

struct Derived : Base {
    using Base::func;  // å¼•å…¥ Base çš„æ‰€æœ‰ func é‡è½½
    void func(char) {}
};
```

------

### 5. **åœ¨å‘½åç©ºé—´ä¸­å¼•å…¥å¦ä¸€ä¸ªå‘½åç©ºé—´çš„åå­—**

```cpp
namespace A {
    void func() {}
}

namespace B {
    using A::func;  // å¼•å…¥ A ä¸­çš„ func åˆ° B
}
```



## decltype

`decltype` æ˜¯ C++11 å¼•å…¥çš„å…³é”®å­—ï¼Œç”¨äº**åœ¨ç¼–è¯‘æ—¶æ¨å¯¼è¡¨è¾¾å¼çš„ç±»å‹**ã€‚å¯ä»¥ç†è§£ä¸ºï¼šä½ å†™ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç¼–è¯‘å™¨å‘Šè¯‰ä½ å®ƒçš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œç„¶åä½ å°±å¯ä»¥ç”¨è¿™ä¸ªç±»å‹æ¥å£°æ˜å˜é‡ã€å‡½æ•°è¿”å›å€¼ã€æ¨¡æ¿ç­‰ã€‚

`decltype` æ˜¯å…³é”®å­—ï¼Œä¸æ˜¯é€šè¿‡æŸä¸ªã€Œå®ç°æœºåˆ¶ã€æ¥è¿è¡Œçš„ä»£ç ï¼Œè€Œæ˜¯ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„**è¯­ä¹‰åˆ†æåŠŸèƒ½**ã€‚

åŸºæœ¬ç”¨æ³•ï¼š

```cpp
int x = 42;
decltype(x) y = x;  // y çš„ç±»å‹å°±æ˜¯ int
```

ä¹Ÿå¯ä»¥ç”¨äºæ›´å¤æ‚çš„è¡¨è¾¾å¼ï¼š

```cpp
int a = 1;
double b = 2.5;

decltype(a + b) c;  // c çš„ç±»å‹æ˜¯ doubleï¼Œå› ä¸º a + b æ˜¯ double
```

------

### æ³¨æ„ï¼šå¼•ç”¨å’Œ const çš„æ¨å¯¼

`decltype` ä¼šä¿ç•™ **å¼•ç”¨æ€§** å’Œ **const é™å®š**ï¼ŒåŒºåˆ«äº `auto`ã€‚

```cpp
int x = 10;
int& rx = x;
const int cx = 20;

decltype(x) a = 1;     // int
decltype(rx) b = x;    // int&ï¼ˆå¼•ç”¨ï¼‰
decltype(cx) d = 2;    // const int
```

------

### å’Œ auto çš„åŒºåˆ«

| ç‰¹æ€§             | `auto`              | `decltype`      |
| ---------------- | ------------------- | --------------- |
| æ¨å¯¼å˜é‡ç±»å‹     | âœ…                   | âœ…               |
| ä¿ç•™å¼•ç”¨ / const | âŒï¼ˆé»˜è®¤å»æ‰ï¼‰       | âœ…ï¼ˆä¿ç•™ï¼‰       |
| å¯ç”¨äºè¡¨è¾¾å¼æ¨å¯¼ | âŒï¼ˆåªèƒ½ç”¨åœ¨åˆå§‹åŒ–ï¼‰ | âœ…ï¼ˆä»»æ„è¡¨è¾¾å¼ï¼‰ |

------

### é…åˆ decltype(auto)

C++14 èµ·ã€‚

```cpp
int x = 10;
int& get() { return x; }

decltype(auto) y = get();  // y æ˜¯ int&ï¼Œå› ä¸º decltype(auto) ä¿ç•™å¼•ç”¨
```

------

### ğŸš§ å°é™·é˜±ï¼ˆç»å…¸ï¼‰

```cpp
int x = 0;
decltype((x)) y = x;  // æ³¨æ„ï¼š((x)) æ˜¯ä¸€ä¸ªå·¦å€¼ï¼ˆå¯å–åœ°å€ï¼‰ï¼Œæ‰€ä»¥ y æ˜¯ int&
decltype(x) z = x;    // x æ˜¯ä¸€ä¸ªå˜é‡åï¼Œz æ˜¯ int
```

å¤šä¸€ä¸ªæ‹¬å·ï¼Œå°±å˜æˆäº†å·¦å€¼è¡¨è¾¾å¼å¯¼è‡´æ¨å¯¼æˆå¼•ç”¨ï¼

* C++ ä¸­åªæœ‰ä¸å¸¦æ‹¬å·çš„å˜é‡åä¼šè¢« `decltype` ç‰¹æ®Šå¤„ç†ï¼Œæ¨å¯¼ä¸ºè£¸ç±»å‹ï¼ˆä¸å¸¦å¼•ç”¨ï¼‰ï¼›
* å…¶å®ƒæ‰€æœ‰è¡¨è¾¾å¼ï¼Œæ— è®ºåŠ ä¸åŠ æ‹¬å·ï¼Œ`decltype` éƒ½ä¼šæ ¹æ®è¡¨è¾¾å¼çš„å€¼ç±»åˆ«è¿”å›å¯¹åº”çš„ç±»å‹ï¼ˆå¯èƒ½å¸¦å¼•ç”¨ï¼‰ã€‚



## __builtin

```cpp
__builtin_clzll(0x34);     // è®¡æ•°å‰å¯¼é›¶ (count leading zero)  795ms   per 1e9 times å‡æ‘Š 10x
__builtin_ctzll(0x34);     // è®¡æ•°åç»§é›¶ (count trailing zero) 403ms   per 1e9 times å‡æ‘Š 2.5x æœ€ä¼˜ 10x
__builtin_popcount(0x34);  // è®¡æ•°ä¸€çš„ä¸ªæ•°                     395ms   per 1e9 times å‡æ‘Š 20x

// è¿ç®—å¹¶åˆ¤æ–­æ˜¯å¦æº¢å‡º
int a = 1e4, b = 1e6, c;
bool p = __builtin_mul_overflow(a, b, &c);
cout << p << " " << c << "\n";
// out: 1 1410065408

// åŒç†è¿˜æœ‰:
__builtin_add_overflow(a, b, &c)
```

